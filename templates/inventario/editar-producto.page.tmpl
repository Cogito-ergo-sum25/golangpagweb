{{template "base" .}}
{{define "content"}}
<div class="container">
    <h2 class="my-4">
        <i class="fa-regular fa-pen-to-square"></i> Editar Producto</h2>
    
    {{with .Flash}}
    <div class="alert alert-success">{{.}}</div>
    {{end}}
    
    {{with .Error}}
    <div class="alert alert-danger">{{.}}</div>
    {{end}}
    
    <form method="POST" action="/editar-producto/{{.Producto.IDProducto}}" class="needs-validation" novalidate>
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header azul">
                        Información Básica
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="sku" class="form-label">SKU *</label>
                            <input type="text" class="form-control" id="sku" name="sku" 
                                   value="{{.Producto.SKU}}" required>
                            <div class="invalid-feedback">Por favor ingresa el SKU</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre *</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" 
                                   value="{{.Producto.Nombre}}" required>
                            <div class="invalid-feedback">Por favor ingresa el nombre</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="nombre_corto" class="form-label">Nombre Corto</label>
                            <input type="text" class="form-control" id="nombre_corto" name="nombre_corto"
                                   value="{{.Producto.NombreCorto}}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="descripcion" class="form-label">Descripción</label>
                            <textarea class="form-control" id="descripcion" name="descripcion" rows="3">{{.Producto.Descripcion}}</textarea>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header azul">
                        Especificaciones Técnicas
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="modelo" class="form-label">Modelo</label>
                            <input type="text" class="form-control" id="modelo" name="modelo"
                                   value="{{.Producto.Modelo}}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="version" class="form-label">Versión</label>
                            <input type="text" class="form-control" id="version" name="version"
                                   value="{{.Producto.Version}}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="serie" class="form-label">Serie</label>
                            <input type="text" class="form-control" id="serie" name="serie"
                                   value="{{.Producto.Serie}}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="codigo_fabricante" class="form-label">Código del Fabricante</label>
                            <input type="text" class="form-control" id="codigo_fabricante" name="codigo_fabricante"
                                   value="{{.Producto.CodigoFabricante}}">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header azul">
                        <i class="fas fa-layer-group me-2"></i> Configuración Avanzada (Tablas Hijo)
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <a href="/producto/inventario/{{.Producto.IDProducto}}" class="btn btn-outline-primary w-100 text-start">
                                    <i class="fas fa-boxes me-2"></i> Inventario
                                </a>
                            </div>
                            <div class="col-6">
                                <a href="/producto/catalogos/{{.Producto.IDProducto}}" class="btn btn-outline-info w-100 text-start">
                                    <i class="fas fa-tags me-2"></i> Catalogos
                                </a>
                            </div>
                            <div class="col-6">
                                <a href="/producto/ieps/{{.Producto.IDProducto}}" class="btn btn-outline-success w-100 text-start">
                                    <i class="fas fa-percent me-2"></i> Multi IEPS
                                </a>
                            </div>
                            <div class="col-6">
                                <a href="/producto/comercio-exterior/{{.Producto.IDProducto}}" class="btn btn-outline-danger w-100 text-start">
                                    <i class="fas fa-globe-americas me-2"></i> Comercio Exterior
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header azul">
                        Clasificación y Origen
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="id_marca" class="form-label">Marca *</label>
                            <select class="form-select" id="id_marca" name="id_marca" required>
                                <option value="">Selecciona una marca</option>
                                {{range .Marcas}}
                                <option value="{{.IDMarca}}" {{if eq .IDMarca $.Producto.IDMarca}}selected{{end}}>{{.Nombre}}</option>
                                {{end}}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_tipo" class="form-label">Tipo de Producto *</label>
                            <select class="form-select" id="id_tipo" name="id_tipo" required>
                                <option value="">Selecciona un tipo</option>
                                {{range .TiposProducto}}
                                <option value="{{.IDTipo}}" {{if eq .IDTipo $.Producto.IDTipo}}selected{{end}}>{{.Nombre}}</option>
                                {{end}}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_clasificacion" class="form-label">Clasificación *</label>
                            <select class="form-select" id="id_clasificacion" name="id_clasificacion" required>
                                <option value="">Selecciona una clasificación</option>
                                {{range .Clasificaciones}}
                                <option value="{{.IDClasificacion}}" {{if eq .IDClasificacion $.Producto.IDClasificacion}}selected{{end}}>{{.Nombre}}</option>
                                {{end}}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_pais_origen" class="form-label">País de Origen *</label>
                            <select class="form-select" id="id_pais_origen" name="id_pais_origen" required>
                                <option value="">Selecciona un país</option>
                                {{range .Paises}}
                                <option value="{{.IDPais}}" {{if eq .IDPais $.Producto.IDPaisOrigen}}selected{{end}}>{{.Nombre}}</option>
                                {{end}}
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header azul">
                        Certificaciones
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {{range .Certificaciones}}
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                        id="cert_{{.IDCertificacion}}" 
                                        name="certificaciones" 
                                        value="{{.IDCertificacion}}"
                                        {{if isCertSelected .IDCertificacion $.CertificacionesProducto}}checked{{end}}>
                                    <label class="form-check-label" for="cert_{{.IDCertificacion}}">
                                        {{.Nombre}}
                                    </label>
                                    <small class="text-muted d-block">{{.OrganismoEmisor}}</small>
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header azul">
                        Documentación
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="imagen_url" class="form-label">URL de Imagen</label>
                            <input type="url" class="form-control" id="imagen_url" name="imagen_url"
                                   value="{{.Producto.ImagenURL}}">
                        </div>
                        <div class="mb-3">
                            <label for="ficha_tecnica_url" class="form-label">URL de Ficha Técnica</label>
                            <input type="url" class="form-control" id="ficha_tecnica_url" name="ficha_tecnica_url"
                                   value="{{.Producto.FichaTecnicaURL}}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="d-flex justify-content-end gap-2 mb-4">
            <a href="/inventario" class="btn btn-lg rojo">
                <i class="fa-regular fa-circle-xmark"></i> Cancelar</a>
            <button type="submit" class="btn btn-lg verde">
                <i class="fas fa-save me-2"></i>Actualizar Información Base</button>
        </div>
    </form>
</div>

<script>
(function() {
  'use strict'
  var forms = document.querySelectorAll('.needs-validation')
  Array.prototype.slice.call(forms)
    .forEach(function(form) {
      form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
})()
</script>
{{end}}