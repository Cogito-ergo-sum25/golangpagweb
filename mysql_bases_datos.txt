-- Tabla marcas
CREATE TABLE marcas (
  id_marca INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla tipos_producto
CREATE TABLE tipos_producto (
  id_tipo INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla clasificaciones
CREATE TABLE clasificaciones (
  id_clasificacion INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla paises
CREATE TABLE paises (
  id_pais INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  codigo VARCHAR(3) NOT NULL
);

-- Tabla certificaciones
CREATE TABLE certificaciones (
  id_certificacion INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  organismo_emisor VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla productos
CREATE TABLE productos (
  id_producto INT AUTO_INCREMENT PRIMARY KEY,
  id_marca INT NOT NULL,
  id_tipo INT NOT NULL,
  id_clasificacion INT NOT NULL,
  id_pais_origen INT NOT NULL,
  
  sku VARCHAR(255) UNIQUE NOT NULL,
  nombre VARCHAR(255) NOT NULL,
  nombre_corto VARCHAR(255),
  modelo VARCHAR(100),
  version VARCHAR(255),
  serie VARCHAR(100),
  codigo_fabricante VARCHAR(100),
  descripcion TEXT,
  
  imagen_url VARCHAR(255),
  ficha_tecnica_url VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (id_marca) REFERENCES marcas(id_marca),
  FOREIGN KEY (id_tipo) REFERENCES tipos_producto(id_tipo),
  FOREIGN KEY (id_clasificacion) REFERENCES clasificaciones(id_clasificacion),
  FOREIGN KEY (id_pais_origen) REFERENCES paises(id_pais)
);

-- Tabla producto_certificaciones (tabla puente)
CREATE TABLE producto_certificaciones (
  id_producto INT NOT NULL,
  id_certificacion INT NOT NULL,
  PRIMARY KEY (id_producto, id_certificacion),
  FOREIGN KEY (id_producto) REFERENCES productos(id_producto),
  FOREIGN KEY (id_certificacion) REFERENCES certificaciones(id_certificacion)
);

-- Tabla entidades
CREATE TABLE entidades (
  id_entidad INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  tipo VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)

-- Tabla licitaciones (depende de entidades)
CREATE TABLE licitaciones (
  id_licitacion INT AUTO_INCREMENT PRIMARY KEY,
  id_entidad INT NOT NULL,
  num_contratacion VARCHAR(255),
  caracter VARCHAR(255),
  nombre VARCHAR(255) NOT NULL,
  estatus VARCHAR(100),
  tipo VARCHAR(100),
  lugar VARCHAR(100),
  privada TINYINT(1) DEFAULT 0,
  fecha_junta DATE,
  fecha_propuestas DATE,
  fecha_fallo DATE,
  fecha_entrega DATE,
  tiempo_entrega VARCHAR(255),
  revisada TINYINT(1) DEFAULT 0,
  intevi TINYINT(1) DEFAULT 0,
  estado VARCHAR(100),
  observaciones_generales TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (id_entidad) REFERENCES entidades(id_entidad)
)

-- Tabla proyectos (depende de licitaciones)
CREATE TABLE proyectos (
  id_proyecto INT AUTO_INCREMENT PRIMARY KEY,
  id_licitacion INT UNIQUE, -- Unique para relaci√≥n 1:1
  nombre VARCHAR(255) NOT NULL,
  descripcion TEXT,
  fecha_inicio DATE,
  fecha_fin DATE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (id_licitacion) REFERENCES licitaciones(id_licitacion)
)

-- Tabla producto_proyecto (tabla puente entre productos y proyecto muchos a muchos)
CREATE TABLE producto_proyecto (
  id_producto INT NOT NULL,
  id_proyecto INT NOT NULL,
  cantidad INT NOT NULL DEFAULT 1,
  precio_unitario DECIMAL(10,2) NOT NULL,
  especificaciones TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id_producto, id_proyecto),
  FOREIGN KEY (id_producto) REFERENCES productos(id_producto) ON DELETE CASCADE,
  FOREIGN KEY (id_proyecto) REFERENCES proyectos(id_proyecto) ON DELETE CASCADE
)